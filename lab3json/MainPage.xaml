<?xml version="1.0" encoding="utf-8"?>
<ContentPage xmlns="http://schemas.microsoft.com/dotnet/2021/maui"
             xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml"
             xmlns:viewmodels="clr-namespace:lab3json.ViewModels"
             x:Class="lab3json.Views.MainPage"
             Title="Диспетчер Гуртожитку">

    <ContentPage.BindingContext>
        <viewmodels:MainViewModel/>
    </ContentPage.BindingContext>

    <ScrollView>
        <VerticalStackLayout Padding="10" Spacing="10">

            <Button Text="Відкрити JSON" Command="{Binding LoadCommand}" BackgroundColor="#512BD4"/>

            <Grid ColumnDefinitions="*, 160, Auto" ColumnSpacing="8" VerticalOptions="Center">
                <Entry Grid.Column="0" 
                       Placeholder="Пошук..." 
                       Text="{Binding SearchText}" />

                <Picker Grid.Column="1" 
                        Title="Критерій" 
                        ItemsSource="{Binding SearchCriteria}" 
                        SelectedItem="{Binding SelectedSearchCriterion}" />

                <Button Grid.Column="2" 
                        Text="Знайти" 
                        Command="{Binding SearchCommand}" 
                        IsEnabled="{Binding IsFileLoaded}"/>
            </Grid>

            <Label Text="{Binding SearchResultText}" FontAttributes="Italic" TextColor="Gray"/>

            <Label Text="Проживання:" FontAttributes="Bold" FontSize="18" Margin="0,10,0,0"/>
            <CollectionView ItemsSource="{Binding Residences}" SelectionMode="Single" SelectedItem="{Binding SelectedResidence}" HeightRequest="200">
                <CollectionView.ItemsLayout>
                    <LinearItemsLayout Orientation="Vertical" ItemSpacing="5"/>
                </CollectionView.ItemsLayout>
                <CollectionView.ItemTemplate>
                    <DataTemplate>
                        <Frame Padding="5" CornerRadius="5" BackgroundColor="#2D2D2D">
                            <VisualStateManager.VisualStateGroups>
                                <VisualStateGroup Name="CommonStates">
                                    <VisualState Name="Normal">
                                        <VisualState.Setters>
                                            <Setter Property="BackgroundColor" Value="#2D2D2D"/>
                                        </VisualState.Setters>
                                    </VisualState>
                                    <VisualState Name="Selected">
                                        <VisualState.Setters>
                                            <Setter Property="BackgroundColor" Value="#505050"/>
                                        </VisualState.Setters>
                                    </VisualState>
                                </VisualStateGroup>
                            </VisualStateManager.VisualStateGroups>
                            <Grid ColumnDefinitions="1*, 2*, 1.5*, 2*" RowSpacing="2">
                                <Label Text="{Binding RoomNumber}" Grid.Column="0" TextColor="White" FontAttributes="Bold"/>
                                <Label Text="{Binding StudentNameRef}" Grid.Column="1" TextColor="#CCCCCC"/>
                                <Label Text="{Binding CheckInDate}" Grid.Column="2" TextColor="#CCCCCC"/>
                                <Label Text="{Binding Notes}" Grid.Column="3" TextColor="#AAAAAA" FontAttributes="Italic"/>
                            </Grid>
                        </Frame>
                    </DataTemplate>
                </CollectionView.ItemTemplate>
            </CollectionView>

            <HorizontalStackLayout Spacing="5">
                <Button Text="+" Clicked="OnAddResidenceClicked" WidthRequest="40" IsEnabled="{Binding IsFileLoaded}"/>
                <Button Text="Ред." Clicked="OnEditResidenceClicked" IsEnabled="{Binding IsFileLoaded}"/>
                <Button Text="Вид." Clicked="OnDeleteResidenceClicked" BackgroundColor="#8B0000" IsEnabled="{Binding IsFileLoaded}"/>
            </HorizontalStackLayout>

            <Label Text="Студенти:" FontAttributes="Bold" FontSize="18" Margin="0,20,0,0"/>
            <CollectionView ItemsSource="{Binding Students}" SelectionMode="Single" SelectedItem="{Binding SelectedStudent}" HeightRequest="200">
                <CollectionView.ItemsLayout>
                    <LinearItemsLayout Orientation="Vertical" ItemSpacing="5"/>
                </CollectionView.ItemsLayout>
                <CollectionView.ItemTemplate>
                    <DataTemplate>
                        <Frame Padding="5" CornerRadius="5" BackgroundColor="#2D2D2D">
                            <VisualStateManager.VisualStateGroups>
                                <VisualStateGroup Name="CommonStates">
                                    <VisualState Name="Normal">
                                        <VisualState.Setters>
                                            <Setter Property="BackgroundColor" Value="#2D2D2D"/>
                                        </VisualState.Setters>
                                    </VisualState>
                                    <VisualState Name="Selected">
                                        <VisualState.Setters>
                                            <Setter Property="BackgroundColor" Value="#505050"/>
                                        </VisualState.Setters>
                                    </VisualState>
                                </VisualStateGroup>
                            </VisualStateManager.VisualStateGroups>
                            <Grid ColumnDefinitions="2*, 1.5*, 1.5*, 1*" RowSpacing="2">
                                <Label Text="{Binding FullName}" Grid.Column="0" TextColor="White" FontAttributes="Bold"/>
                                <Label Text="{Binding Faculty}" Grid.Column="1" TextColor="#CCCCCC"/>
                                <Label Text="{Binding Department}" Grid.Column="2" TextColor="#CCCCCC"/>
                                <Label Text="{Binding Course}" Grid.Column="3" TextColor="#CCCCCC" HorizontalTextAlignment="Center"/>
                            </Grid>
                        </Frame>
                    </DataTemplate>
                </CollectionView.ItemTemplate>
            </CollectionView>

            <HorizontalStackLayout Spacing="5">
                <Button Text="+" Clicked="OnAddStudentClicked" WidthRequest="40" IsEnabled="{Binding IsFileLoaded}"/>
                <Button Text="Ред." Clicked="OnEditStudentClicked" IsEnabled="{Binding IsFileLoaded}"/>
                <Button Text="Вид." Clicked="OnDeleteStudentClicked" BackgroundColor="#8B0000" IsEnabled="{Binding IsFileLoaded}"/>
            </HorizontalStackLayout>

            <BoxView HeightRequest="1" Color="Gray" Margin="0,15"/>

            <HorizontalStackLayout Spacing="10" HorizontalOptions="Center">
                <Button Text="ЗБЕРЕГТИ" Command="{Binding SaveCommand}" BackgroundColor="Green" IsEnabled="{Binding IsFileLoaded}"/>
                <Button Text="Про програму" Clicked="OnAboutClicked" BackgroundColor="Gray"/>
            </HorizontalStackLayout>

        </VerticalStackLayout>
    </ScrollView>
</ContentPage>